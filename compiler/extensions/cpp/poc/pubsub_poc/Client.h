/**
 * Automatically generated by Zserio C++ extension version 1.4.0-pre2.
 */

#ifndef SIMPLE_PUB_SUB_H
#define SIMPLE_PUB_SUB_H

#include <functional>
#include <string>
#include <vector>
#include <map>

#include "zserio_runtime/IPubSubClient.h"

#include "pubsub_poc/UInt64Value.h"
#include "pubsub_poc/Int32Value.h"
#include "pubsub_poc/BoolValue.h"

namespace pubsub_poc
{

class Client
{
public:
    explicit Client(::zserio::IPubSubClient& pubSubClient);
    ~Client() = default;

    Client(const Client&) = default;
    Client& operator=(const Client&) = default;

    Client(Client&&) = default;
    Client& operator=(Client&&) = default;

    void publishRequest(::pubsub_poc::Int32Value& object, void* context = nullptr) const;

    ::zserio::IPubSubClient::SubscriptionId subscribePowerOfTwo(
            const std::function<void(const std::string& topic, const ::pubsub_poc::UInt64Value& object)>& callback,
            void* context = nullptr);
    void unsubscribePowerOfTwo(zserio::IPubSubClient::SubscriptionId id);

    ::zserio::IPubSubClient::SubscriptionId subscribeBooleanResponse(
            const std::function<void(const std::string& topic, const ::pubsub_poc::BoolValue& object)>& callback,
            void* context = nullptr);
    void unsubscribeBooleanResponse(zserio::IPubSubClient::SubscriptionId id);

private:
    void onRawUInt64Value(zserio::IPubSubClient::SubscriptionId id, const std::string& topic,
            const std::vector<uint8_t>& data) const;
    void onRawBoolValue(zserio::IPubSubClient::SubscriptionId id, const std::string& topic,
            const std::vector<uint8_t>& data) const;

    template<typename ZSERIO_OBJECT>
    void publishZserioObject(ZSERIO_OBJECT& object, const std::string& topic, void* context) const;

    zserio::IPubSubClient& m_pubSubClient;

    std::map<::zserio::IPubSubClient::SubscriptionId,
            std::function<void(const std::string& topic,
                    const ::pubsub_poc::UInt64Value& object)>> m_subscribersUInt64Value;
    std::map<::zserio::IPubSubClient::SubscriptionId,
            std::function<void(const std::string& topic,
                    const ::pubsub_poc::BoolValue& object)>> m_subscribersBoolValue;
};

} // namespace pubsub_poc

#endif // ifndef SIMPLE_PUB_SUB_H
